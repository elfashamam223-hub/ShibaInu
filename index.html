<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shiba Inu Reward</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src='//libtl.com/sdk.js' data-zone='9682710' data-sdk='show_9682710'></script>
<style>
    body { font-family: Arial, sans-serif; background: #fff4e6; margin: 0; padding: 0; text-align: center; }
    .container { padding: 20px; }
    .logo { width: 100px; margin: 10px auto; }
    .balance { font-size: 20px; margin: 10px 0; }
    button { padding: 10px 20px; font-size: 16px; margin: 10px; border-radius: 8px; border: none; cursor: pointer; }
    .watch-ad { background: #ff9900; color: white; }
    .withdraw { background: #ff3366; color: white; }
    .leaderboard { background: #fff; border-radius: 8px; padding: 10px; margin-top: 15px; }
    form input { padding: 10px; margin: 5px; width: 80%; max-width: 300px; }
    .binance-logo { width: 100px; margin-top: 20px; }
</style>
</head>
<body>
<div class="container" id="login-page">
    <h2>üîë Login</h2>
    <form id="loginForm">
        <input type="text" id="name" placeholder="Your Name" required><br>
        <input type="email" id="email" placeholder="Binance/FaucetPay Email" required><br>
        <button type="submit">Login</button>
    </form>
</div>

<div class="container" id="main-page" style="display:none;">
    <img src="https://i.pinimg.com/736x/2b/67/3a/2b673ae57cd8d2c4344945ea6c36bd17.jpg" class="logo">
    <h2>üöÄ Welcome, <span id="username"></span></h2>
    <div class="balance">üí∞ Balance: <span id="balance">0</span> SHIB</div>
    <button class="watch-ad" id="watchBtn">üì∫ Watch Ad (+8 SHIB)</button>

    <h3>üèÜ Top 10 Earners</h3>
    <div class="leaderboard" id="leaderboard">Loading...</div>

    <h3>üí∏ Withdraw</h3>
    <form id="withdrawForm">
        <input type="text" id="w_name" placeholder="Your Name" required><br>
        <input type="email" id="w_email" placeholder="Binance/FaucetPay Email" required><br>
        <input type="number" id="w_amount" placeholder="Amount (min 120)" required><br>
        <button type="submit" class="withdraw">Withdraw</button>
    </form>

    <img src="https://cryptologos.cc/logos/binance-coin-bnb-logo.svg" class="binance-logo">
</div>

<script>
const APPS_SCRIPT_URL = "PASTE_YOUR_APPS_SCRIPT_URL";
const SECRET_KEY = "YOUR_SECRET_KEY";
let currentUser = {};

document.getElementById("loginForm").addEventListener("submit", async function(e){
    e.preventDefault();
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();

    // Simpan ke sheet
    await fetch(APPS_SCRIPT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            secret: SECRET_KEY,
            action: "register",
            name: name,
            email: email
        })
    });

    currentUser = { name, email };
    document.getElementById("username").innerText = name;
    loadBalance();
    loadLeaderboard();
    document.getElementById("login-page").style.display = "none";
    document.getElementById("main-page").style.display = "block";
});

async function loadBalance(){
    const res = await fetch(`${APPS_SCRIPT_URL}?secret=${SECRET_KEY}&action=get_balance&email=${encodeURIComponent(currentUser.email)}`);
    const data = await res.json();
    document.getElementById("balance").innerText = data.balance;
}

async function loadLeaderboard(){
    const res = await fetch(`${APPS_SCRIPT_URL}?secret=${SECRET_KEY}&action=top10`);
    const topUsers = await res.json();
    document.getElementById("leaderboard").innerHTML = topUsers.map(u => `${u.name} ‚Äî ${u.balance} SHIB`).join("<br>");
}

document.getElementById("watchBtn").addEventListener("click", async () => {
    try {
        document.getElementById("watchBtn").disabled = true;
        await show_9682710();
        await fetch(APPS_SCRIPT_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                secret: SECRET_KEY,
                action: "add_balance",
                email: currentUser.email,
                amount: 8
            })
        });
        alert("+8 SHIB added!");
        loadBalance();
    } catch (err) {
        alert("Ad failed or skipped.");
    } finally {
        setTimeout(() => document.getElementById("watchBtn").disabled = false, 15000);
    }
});

document.getElementById("withdrawForm").addEventListener("submit", async function(e){
    e.preventDefault();
    const name = document.getElementById("w_name").value.trim();
    const email = document.getElementById("w_email").value.trim();
    const amount = parseInt(document.getElementById("w_amount").value);

    if(amount < 120){ alert("Minimum withdraw is 120 SHIB."); return; }

    // Iklan popup sebelum withdraw
    show_9682710('pop').then(async () => {
        await fetch(APPS_SCRIPT_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                secret: SECRET_KEY,
                action: "withdraw",
                name: name,
                email: email,
                amount: amount
            })
        });
        alert("Withdraw request sent!");
        loadBalance();
    }).catch(() => {
        alert("Withdraw cancelled. Ad not completed.");
    });
});
</script>
</body>
</html>
