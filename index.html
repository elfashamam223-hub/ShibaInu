<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shiba Inu Reward</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Monetag Ad SDK -->
    <script src='//libtl.com/sdk.js' data-zone='9682710' data-sdk='show_9682710'></script>

    <style>
        body { font-family: Arial, sans-serif; background: #ffeed0; text-align: center; padding: 20px; }
        .logo { width: 100px; margin-top: 20px; }
        .balance { font-size: 24px; margin: 10px 0; }
        button { padding: 10px 20px; font-size: 16px; margin: 10px; border-radius: 8px; border: none; cursor: pointer; }
        .watch-ad { background: #ff9900; color: white; }
        .withdraw { background: #ff3366; color: white; }
        .leaderboard, .latest { background: #fff8ee; padding: 10px; border-radius: 8px; margin-top: 20px; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>
    <img src="https://i.pinimg.com/736x/2b/67/3a/2b673ae57cd8d2c4344945ea6c36bd17.jpg" alt="Shiba Inu" class="logo">
    <h2>ğŸš€ Shiba Inu Reward</h2>
    <div id="user-info">Loading...</div>
    <div class="balance">ğŸ’° Balance: <span id="balance">0</span> SHIB</div>
    <button id="watchBtn" class="watch-ad" onclick="watchAd()">ğŸ“º Watch Ad (+8 SHIB)</button>
    <button class="withdraw" onclick="openWithdraw()">ğŸ’¸ Withdraw</button>

    <h3>ğŸ† Top Users</h3>
    <div class="leaderboard" id="leaderboard">Loading...</div>

    <h3>ğŸ†• Latest Withdrawals</h3>
    <div class="latest" id="latest">Loading...</div>

    <p>One day $SHIB will hit $1... âœ¨</p>

    <script>
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxHFMeqk5YDai9_e4g6oXljLHvGm6KF7ANUd8lSxSaLIZsAVZBh7fXXJ7gQM6mMiCgE/exec";
        const SECRET_KEY = "Elfaidasany";

        const watchBtn = document.getElementById("watchBtn");

        const urlParams = new URLSearchParams(window.location.search);
        const telegramId = urlParams.get("uid");

        async function getUserData() {
            try {
                const res = await fetch(`${APPS_SCRIPT_URL}?secret=${SECRET_KEY}&action=get_balance&telegram_id=${telegramId}`);
                const data = await res.json();
                document.getElementById("user-info").innerText = `ğŸ‘‹ Hello, ${data.username}`;
                document.getElementById("balance").innerText = data.balance;
            } catch (err) {
                console.error(err);
                document.getElementById("user-info").innerText = "âŒ Failed to load user.";
            }
        }

        async function loadLeaderboard() {
            const res = await fetch(`${APPS_SCRIPT_URL}?secret=${SECRET_KEY}&action=top10`);
            const topUsers = await res.json();
            document.getElementById("leaderboard").innerHTML = topUsers.map(u => `${u.username} â€” ${u.balance} SHIB`).join("<br>");
        }

        async function loadLatestWithdrawals() {
            const res = await fetch(`${APPS_SCRIPT_URL}?secret=${SECRET_KEY}&action=latest`);
            const latest = await res.json();
            document.getElementById("latest").innerHTML = latest.map(w => `${w.username} â€” ${w.amount} SHIB`).join("<br>");
        }

        async function watchAd() {
            try {
                // Disable tombol selama 15 detik
                watchBtn.disabled = true;
                await show_9682710();
                await fetch(APPS_SCRIPT_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        secret: SECRET_KEY,
                        action: "add_balance",
                        telegram_id: telegramId,
                        amount: 8
                    })
                });
                alert("âœ… Ad finished! +8 SHIB added.");
                getUserData();
            } catch (err) {
                console.error("Ad error:", err);
                alert("âŒ Ad failed or was skipped.");
            } finally {
                setTimeout(() => watchBtn.disabled = false, 15000);
            }
        }

        function openWithdraw() {
            const username = prompt("Enter your Telegram username (without @):");
            const email = prompt("Enter your Binance email:");
            const amount = parseInt(prompt("Enter amount to withdraw:"));

            if (!username || !email || isNaN(amount)) {
                alert("âŒ All fields are required.");
                return;
            }
            if (amount < 120) {
                alert("âŒ Minimum withdraw is 120 SHIB.");
                return;
            }

            // Tampilkan iklan popup sebelum kirim withdraw
            show_9682710('pop').then(() => {
                fetch(APPS_SCRIPT_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        secret: SECRET_KEY,
                        action: "withdraw",
                        telegram_id: telegramId,
                        username: username,
                        email: email,
                        amount: amount
                    })
                })
                .then(() => alert("âœ… Withdraw request sent!"))
                .catch(err => console.error(err));
            }).catch(e => {
                console.error("Popup ad error:", e);
                alert("âŒ Withdraw cancelled. Ad not completed.");
            });
        }

        // Load data awal
        getUserData();
        loadLeaderboard();
        loadLatestWithdrawals();
    </script>
</body>
</html>
